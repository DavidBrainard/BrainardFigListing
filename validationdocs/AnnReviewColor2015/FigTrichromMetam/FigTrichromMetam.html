
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>FigTrichromMetam</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2015-07-31"><meta name="DC.source" content="FigTrichromMetam.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Clear</a></li><li><a href="#3">Hello</a></li><li><a href="#4">Figure parameters</a></li><li><a href="#5">Load data and compute a metameric pair</a></li><li><a href="#6">We also need some anomolous cones for some purposes</a></li><li><a href="#7">Make a bar plot of cone responses to the two lights</a></li><li><a href="#8">Make the cone sensitivity figure</a></li><li><a href="#9">Make the metamer figure</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> varargout = FigTrichromMetam(varargin)
<span class="comment">%</span>
<span class="comment">% Show human cone sensitivities and a metamer.</span>
<span class="comment">%</span>
<span class="comment">% Used to produce panels for Figure 1 of the 2015 Annual Review Vision</span>
<span class="comment">% Science paper.</span>
<span class="comment">%   Panel A: FigTrichromCones.pdf</span>
<span class="comment">%   Panel B: FigTrichromMetam.pdf</span>
<span class="comment">%</span>
<span class="comment">% See also FigDichromMetam, FigSpatioCHromaticAliasing.</span>
<span class="comment">%</span>
<span class="comment">% 3/23/15   dhb  Wrote it.</span>
<span class="comment">% 4/20/15   dhb  Bring into the validation fold</span>
<span class="comment">% 4/29/15   dhb  Added some extra explanatory plots</span>

varargout = UnitTest.runValidationRun(@ValidationFunction, nargout, varargin);
<span class="keyword">end</span>

<span class="keyword">function</span> ValidationFunction(runTimeParams)
</pre><h2>Clear<a name="2"></a></h2><pre class="codeinput">ieInit;
</pre><h2>Hello<a name="3"></a></h2><pre class="codeinput">UnitTest.validationRecord(<span class="string">'SIMPLE_MESSAGE'</span>, sprintf(<span class="string">'%s'</span>,mfilename));
outputDir = sprintf(<span class="string">'%s_Output'</span>,mfilename);
<span class="keyword">if</span> (~exist(outputDir,<span class="string">'dir'</span>))
    mkdir(outputDir);
<span class="keyword">end</span>
</pre><h2>Figure parameters<a name="4"></a></h2><pre class="codeinput">curDir = pwd;
masterFigParamsDir = getpref(<span class="string">'bfScripts'</span>,<span class="string">'masterFigParamsDir'</span>);
cd(masterFigParamsDir);
figParams = MasterFigParams;
cd(curDir);
<span class="keyword">if</span> (exist(<span class="string">'../SecondaryFigParams'</span>,<span class="string">'file'</span>))
    cd <span class="string">..</span>
    figParams = SecondaryFigParams(figParams);
    cd(curDir);
<span class="keyword">end</span>
</pre><h2>Load data and compute a metameric pair<a name="5"></a></h2><p>Cone sensitivities.  Let's be pros and show unnormalized quantal sensitivities.  And, use isetbio to generate the data for the plots.</p><pre class="codeinput">sensor = sensorCreate(<span class="string">'human'</span>);
wave   = sensorGet(sensor,<span class="string">'wave'</span>);
S_in = WlsToS(wave);
T_conesQE_in = sensorGet(sensor,<span class="string">'spectral qe'</span>)';
S = [390 5 65];
wls = SToWls(S);
T_conesQETrichrom = SplineCmf(S_in,T_conesQE_in(2:4,:),S);
UnitTest.validationData(<span class="string">'S'</span>, S);
UnitTest.validationData(<span class="string">'T_conesQETrichrom'</span>, T_conesQETrichrom);
</pre><h2>We also need some anomolous cones for some purposes<a name="6"></a></h2><p>To get these, use PTB routines.  See v_Cones for some validation of how these compare to what is returned by isetbio, but it's pretty good.  The absorbance based agreement is better than the nomogram based agreement, because the SS nomogram doesn't perfectly match up with the tabulated SS absorbance.</p><p>I didn't actually add any validation checks on these here, because I am too lazy to regenerate the validation data for this function.</p><pre class="codeinput">ptbPhotoreceptorsSS2 = ptb.StockmanSharpePhotoreceptors(SToWls(S));
ptbPhotoreceptorsAnom = DefaultPhotoreceptors(<span class="string">'CIE2Deg'</span>);
ptbPhotoreceptorsAnom.nomogram.S = S;
ptbPhotoreceptorsAnom.nomogram.source = <span class="string">'StockmanSharpe'</span>;
ptbPhotoreceptorsAnom.nomogram.lambdaMax = [558.9 545 420.7]';
ptbPhotoreceptorsAnom = rmfield(ptbPhotoreceptorsAnom,<span class="string">'absorbance'</span>);
ptbPhotoreceptorsAnom = FillInPhotoreceptors(ptbPhotoreceptorsAnom);
T_conesQETrichromAnom = [T_conesQETrichrom(1,:) ; ptbPhotoreceptorsAnom.isomerizationAbsorptance(2,:) ; T_conesQETrichrom(3,:)];
T_conesQETetra = [ptbPhotoreceptorsSS2.isomerizationAbsorptance ; ptbPhotoreceptorsAnom.isomerizationAbsorptance(2,:)];

<span class="comment">% Energy sensitivities.  We need these to convert the isomerizations</span>
<span class="comment">% into the right relative scaling for SRGB rendering.</span>
T_conesTrichrom = EnergyToQuanta(S,T_conesQETrichrom')';
T_conesTrichrom = T_conesTrichrom/max(T_conesTrichrom(:));
<span class="keyword">for</span> ii = 1:3
    renderingScaleFactors(ii) = 1/max(T_conesTrichrom(ii,:));
<span class="keyword">end</span>
UnitTest.validationData(<span class="string">'renderingScaleFactors'</span>, renderingScaleFactors);

<span class="comment">% Some spectra.  We treat these as in quantal units,</span>
<span class="comment">% though since we never say in the paper what they</span>
<span class="comment">% are, it doesn't really matter where we got them.</span>
load <span class="string">sur_mccBabel</span>
theSpd = SplineSpd(S_mccBabel,<span class="keyword">...</span>
    figParams.spectralConstant*ones(size(sur_mccBabel(:,figParams.whichMCCSquare))) + <span class="keyword">...</span>
    figParams.mccSquareScale*sur_mccBabel(:,figParams.whichMCCSquare) + <span class="keyword">...</span>
    figParams.mccSquareScale2*sur_mccBabel(:,figParams.whichMCCSquare2) + <span class="keyword">...</span>
    figParams.mccSquareScale3*sur_mccBabel(:,figParams.whichMCCSquare3),S);
theSpdCones = T_conesQETrichrom*theSpd;
UnitTest.validationData(<span class="string">'theSpd'</span>, theSpd);
UnitTest.validationData(<span class="string">'theSpdCones'</span>, theSpdCones);

<span class="comment">% Some monitor primaries</span>
load <span class="string">B_monitor</span>
B = SplineSpd(S_monitor,B_monitor,S);
UnitTest.validationData(<span class="string">'B'</span>, B);

<span class="comment">% Compute monitor metamer for spd</span>
theMetamer = B*inv(T_conesQETrichrom*B)*T_conesQETrichrom*theSpd;
theMetamerCones = T_conesQETrichrom*theMetamer;
UnitTest.validationData(<span class="string">'theMetamer'</span>, theMetamer);
UnitTest.validationData(<span class="string">'theMetamerCones'</span>, theMetamerCones);
</pre><h2>Make a bar plot of cone responses to the two lights<a name="7"></a></h2><pre class="codeinput">mid1 = 1; mid2 = 2.5; mid3 = 4.0; sep = 0.25;
figParams.figName = <span class="string">'FigTrichromHistoTrichomMetamers'</span>;
figParams.barWidth = 0.4;
figParams.barLineWidth = 5;
figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
xlim([sep mid3+sep+figParams.barWidth]);
h1 = bar([mid1 - sep]',[theSpdCones(1)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth);
h2 = bar([mid1 + sep]',[theMetamerCones(1)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth,<span class="string">'LineStyle'</span>,<span class="string">':'</span>);
h3 = bar([mid2 - sep]',[theSpdCones(2)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth);
h4 = bar([mid2 + sep]',[theMetamerCones(2)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth,<span class="string">'LineStyle'</span>,<span class="string">':'</span>);
h5 = bar([mid3 - sep]',[theSpdCones(3)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth);
h6 = bar([mid3 + sep]',[theMetamerCones(3)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth,<span class="string">'LineStyle'</span>,<span class="string">':'</span>);
set(gca,<span class="string">'XTick'</span>,[mid1 mid2 mid3]);
set(gca,<span class="string">'XTickLabel'</span>,{<span class="string">'L'</span> <span class="string">'Ms'</span> <span class="string">'S'</span>},<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize+4);
ylim([0 1]);
set(gca,<span class="string">'YTick'</span>,[0 0.5 1]);
set(gca,<span class="string">'YTickLabel'</span>,{<span class="string">' 0.00 '</span>, <span class="string">' 0.50 '</span>, <span class="string">' 1.00 '</span>},<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylabel(<span class="string">'Isomerization Rate (arbitrary units)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),gcf,figParams.figType);

<span class="comment">% and just to the first light (for explanatory purposes)</span>
figParams.figName = <span class="string">'FigTrichromHistoTrichomMetamersOne'</span>;
figParams.barWidth = 0.4;
figParams.barLineWidth = 5;
figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
xlim([sep mid3+sep+figParams.barWidth]);
h1 = bar([mid1 - sep]',[theSpdCones(1)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth);
h3 = bar([mid2 - sep]',[theSpdCones(2)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth);
h5 = bar([mid3 - sep]',[theSpdCones(3)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth);
set(gca,<span class="string">'XTick'</span>,[mid1 mid2 mid3]);
set(gca,<span class="string">'XTickLabel'</span>,{<span class="string">'L'</span> <span class="string">'M'</span> <span class="string">'S'</span>},<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize+4);
ylim([0 1]);
set(gca,<span class="string">'YTick'</span>,[0 0.5 1]);
set(gca,<span class="string">'YTickLabel'</span>,{<span class="string">' 0.00 '</span>, <span class="string">' 0.50 '</span>, <span class="string">' 1.00 '</span>},<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylabel(<span class="string">'Isomerization Rate (arbitrary units)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),gcf,figParams.figType);

<span class="comment">% and just L cone response to first light  (again, for explanatory purposes)</span>
figParams.figName = <span class="string">'FigTrichromHistoTrichomMetamersOneLOnly'</span>;
figParams.barWidth = 0.4;
figParams.barLineWidth = 5;
figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
xlim([sep mid3+sep+figParams.barWidth]);
h1 = bar([mid1 - sep]',[theSpdCones(1)],figParams.barWidth,<span class="string">'FaceColor'</span>,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,figParams.barLineWidth);
set(gca,<span class="string">'XTick'</span>,[mid1 mid2 mid3]);
set(gca,<span class="string">'XTickLabel'</span>,{<span class="string">'L'</span> <span class="string">'M'</span> <span class="string">'S'</span>},<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize+4);
ylim([0 1]);
set(gca,<span class="string">'YTick'</span>,[0 0.5 1]);
set(gca,<span class="string">'YTickLabel'</span>,{<span class="string">' 0.00 '</span>, <span class="string">' 0.50 '</span>, <span class="string">' 1.00 '</span>},<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylabel(<span class="string">'Isomerization Rate (arbitrary units)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),gcf,figParams.figType);
</pre><img vspace="5" hspace="5" src="FigTrichromMetam_01.png" alt=""> <img vspace="5" hspace="5" src="FigTrichromMetam_02.png" alt=""> <img vspace="5" hspace="5" src="FigTrichromMetam_03.png" alt=""> <h2>Make the cone sensitivity figure<a name="8"></a></h2><pre class="codeinput">figParams.figName = <span class="string">'FigTrichromCones'</span>;
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {<span class="string">'400'</span> <span class="string">'500'</span> <span class="string">'600'</span> <span class="string">'700'</span>};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 0.51;
figParams.yTicks = [0.0 0.25 0.5];
figParams.yTickLabels = {<span class="string">' 0.00 '</span> <span class="string">' 0.25 '</span> <span class="string">' 0.50 '</span>};
theFig = figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
plot(wls,T_conesQETrichrom(1,:)',<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,T_conesQETrichrom(2,:)',<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,T_conesQETrichrom(3,:)',<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,<span class="string">'XTick'</span>,figParams.xTicks);
set(gca,<span class="string">'XTickLabel'</span>,figParams.xTickLabels);
xlabel(<span class="string">'Wavelength (nm)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel(<span class="string">'Quantal Efficiency'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
set(gca,<span class="string">'YTick'</span>,figParams.yTicks);
set(gca,<span class="string">'YTickLabel'</span>,figParams.yTickLabels);
legend({<span class="string">' L cones '</span> <span class="string">' M cones '</span> <span class="string">' S cones '</span>},<span class="string">'Location'</span>,<span class="string">'NorthEast'</span>,<span class="string">'FontSize'</span>,figParams.legendFontSize);
axis(<span class="string">'square'</span>);
<span class="comment">%set(gca,'XMinorTick','on');</span>
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),theFig,figParams.figType);

<span class="comment">% and an anomalous version for explanatory purposes</span>
figParams.figName = <span class="string">'FigTrichromAnomCones'</span>;
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {<span class="string">'400'</span> <span class="string">'500'</span> <span class="string">'600'</span> <span class="string">'700'</span>};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 0.51;
figParams.yTicks = [0.0 0.25 0.5];
figParams.yTickLabels = {<span class="string">' 0.00 '</span> <span class="string">' 0.25 '</span> <span class="string">' 0.50 '</span>};
theFig = figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
plot(wls,T_conesQETrichromAnom(1,:)',<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,T_conesQETrichromAnom(2,:)',<span class="string">'y'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,T_conesQETrichromAnom(3,:)',<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,<span class="string">'XTick'</span>,figParams.xTicks);
set(gca,<span class="string">'XTickLabel'</span>,figParams.xTickLabels);
xlabel(<span class="string">'Wavelength (nm)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel(<span class="string">'Quantal Efficiency'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
set(gca,<span class="string">'YTick'</span>,figParams.yTicks);
set(gca,<span class="string">'YTickLabel'</span>,figParams.yTickLabels);
legend({<span class="string">' L cones '</span> <span class="string">' M'' cones '</span> <span class="string">' S cones '</span>},<span class="string">'Location'</span>,<span class="string">'NorthEast'</span>,<span class="string">'FontSize'</span>,figParams.legendFontSize);
axis(<span class="string">'square'</span>);
<span class="comment">%set(gca,'XMinorTick','on');</span>
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),theFig,figParams.figType);

<span class="comment">% and an tetrachomatic version for explanatory purposes</span>
figParams.figName = <span class="string">'FigTetraCones'</span>;
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {<span class="string">'400'</span> <span class="string">'500'</span> <span class="string">'600'</span> <span class="string">'700'</span>};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 0.51;
figParams.yTicks = [0.0 0.25 0.5];
figParams.yTickLabels = {<span class="string">' 0.00 '</span> <span class="string">' 0.25 '</span> <span class="string">' 0.50 '</span>};
theFig = figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
plot(wls,T_conesQETetra(1,:)',<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,T_conesQETetra(4,:)',<span class="string">'y'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,T_conesQETetra(2,:)',<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,T_conesQETetra(3,:)',<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,<span class="string">'XTick'</span>,figParams.xTicks);
set(gca,<span class="string">'XTickLabel'</span>,figParams.xTickLabels);
xlabel(<span class="string">'Wavelength (nm)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel(<span class="string">'Quantal Efficiency'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
set(gca,<span class="string">'YTick'</span>,figParams.yTicks);
set(gca,<span class="string">'YTickLabel'</span>,figParams.yTickLabels);
legend({<span class="string">' L cones '</span> <span class="string">' M'' cones '</span> <span class="string">' M cones '</span> <span class="string">'S cones'</span>},<span class="string">'Location'</span>,<span class="string">'NorthEast'</span>,<span class="string">'FontSize'</span>,figParams.legendFontSize);
axis(<span class="string">'square'</span>);
<span class="comment">%set(gca,'XMinorTick','on');</span>
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),theFig,figParams.figType);
</pre><img vspace="5" hspace="5" src="FigTrichromMetam_04.png" alt=""> <img vspace="5" hspace="5" src="FigTrichromMetam_05.png" alt=""> <img vspace="5" hspace="5" src="FigTrichromMetam_06.png" alt=""> <h2>Make the metamer figure<a name="9"></a></h2><pre class="codeinput">figParams.figName = <span class="string">'FigTrichromMetam'</span>;
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {<span class="string">'400'</span> <span class="string">'500'</span> <span class="string">'600'</span> <span class="string">'700'</span>};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 1.01;
figParams.yTicks = [0.0 0.25 0.5 0.75 1.0];
figParams.yTickLabels = {<span class="string">' 0.00 '</span> <span class="string">' 0.25 '</span> <span class="string">' 0.50 '</span> <span class="string">' 0.75 '</span> <span class="string">' 1.00 '</span>};
theFig = figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
plot(wls,theSpd,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
plot(wls,theMetamer,<span class="string">'k:'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,<span class="string">'XTick'</span>,figParams.xTicks);
set(gca,<span class="string">'XTickLabel'</span>,figParams.xTickLabels);
xlabel(<span class="string">'Wavelength (nm)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel(<span class="string">'Power (arbitrary quantal units)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
set(gca,<span class="string">'YTick'</span>,figParams.yTicks);
set(gca,<span class="string">'YTickLabel'</span>,figParams.yTickLabels);
axis(<span class="string">'square'</span>);
<span class="comment">%set(gca,'XMinorTick','on');</span>
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),theFig,figParams.figType);

<span class="comment">% and a version with just the first spectrum</span>
figParams.figName = <span class="string">'FigTrichromMetamOne'</span>;
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {<span class="string">'400'</span> <span class="string">'500'</span> <span class="string">'600'</span> <span class="string">'700'</span>};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 1.01;
figParams.yTicks = [0.0 0.25 0.5 0.75 1.0];
figParams.yTickLabels = {<span class="string">' 0.00 '</span> <span class="string">' 0.25 '</span> <span class="string">' 0.50 '</span> <span class="string">' 0.75 '</span> <span class="string">' 1.00 '</span>};
theFig = figure; clf; hold <span class="string">on</span>
set(gcf,<span class="string">'Position'</span>,[100 100 figParams.sqSize figParams.sqSize]);
set(gca,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.axisFontSize,<span class="string">'LineWidth'</span>,figParams.axisLineWidth);
plot(wls,theSpd,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,<span class="string">'XTick'</span>,figParams.xTicks);
set(gca,<span class="string">'XTickLabel'</span>,figParams.xTickLabels);
xlabel(<span class="string">'Wavelength (nm)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel(<span class="string">'Power (arbitrary quantal units)'</span>,<span class="string">'FontName'</span>,figParams.fontName,<span class="string">'FontSize'</span>,figParams.labelFontSize);
set(gca,<span class="string">'YTick'</span>,figParams.yTicks);
set(gca,<span class="string">'YTickLabel'</span>,figParams.yTickLabels);
axis(<span class="string">'square'</span>);
<span class="comment">%set(gca,'XMinorTick','on');</span>
FigureSave(fullfile(outputDir,[mfilename <span class="string">'_'</span> figParams.figName]),theFig,figParams.figType);
</pre><img vspace="5" hspace="5" src="FigTrichromMetam_07.png" alt=""> <img vspace="5" hspace="5" src="FigTrichromMetam_08.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
##### SOURCE BEGIN #####
function varargout = FigTrichromMetam(varargin)
%
% Show human cone sensitivities and a metamer.
%
% Used to produce panels for Figure 1 of the 2015 Annual Review Vision
% Science paper.
%   Panel A: FigTrichromCones.pdf
%   Panel B: FigTrichromMetam.pdf
%
% See also FigDichromMetam, FigSpatioCHromaticAliasing.
%
% 3/23/15   dhb  Wrote it.
% 4/20/15   dhb  Bring into the validation fold
% 4/29/15   dhb  Added some extra explanatory plots

varargout = UnitTest.runValidationRun(@ValidationFunction, nargout, varargin);
end

function ValidationFunction(runTimeParams)
    
%% Clear
ieInit;

%% Hello
UnitTest.validationRecord('SIMPLE_MESSAGE', sprintf('%s',mfilename));
outputDir = sprintf('%s_Output',mfilename);
if (~exist(outputDir,'dir'))
    mkdir(outputDir);
end

%% Figure parameters
curDir = pwd;
masterFigParamsDir = getpref('bfScripts','masterFigParamsDir');
cd(masterFigParamsDir);
figParams = MasterFigParams;
cd(curDir);
if (exist('../SecondaryFigParams','file'))
    cd ..
    figParams = SecondaryFigParams(figParams);
    cd(curDir);
end

%% Load data and compute a metameric pair
%
% Cone sensitivities.  Let's be pros and show
% unnormalized quantal sensitivities.  And, use
% isetbio to generate the data for the plots.
sensor = sensorCreate('human');
wave   = sensorGet(sensor,'wave');
S_in = WlsToS(wave);
T_conesQE_in = sensorGet(sensor,'spectral qe')';
S = [390 5 65];
wls = SToWls(S);
T_conesQETrichrom = SplineCmf(S_in,T_conesQE_in(2:4,:),S);
UnitTest.validationData('S', S);
UnitTest.validationData('T_conesQETrichrom', T_conesQETrichrom);

%% We also need some anomolous cones for some purposes
%
% To get these, use PTB routines.  See v_Cones for some validation of how
% these compare to what is returned by isetbio, but it's pretty good.  The
% absorbance based agreement is better than the nomogram based agreement,
% because the SS nomogram doesn't perfectly match up with the tabulated SS
% absorbance.
%
% I didn't actually add any validation checks on these here, because I am
% too lazy to regenerate the validation data for this function.
ptbPhotoreceptorsSS2 = ptb.StockmanSharpePhotoreceptors(SToWls(S));
ptbPhotoreceptorsAnom = DefaultPhotoreceptors('CIE2Deg');
ptbPhotoreceptorsAnom.nomogram.S = S;
ptbPhotoreceptorsAnom.nomogram.source = 'StockmanSharpe';
ptbPhotoreceptorsAnom.nomogram.lambdaMax = [558.9 545 420.7]';
ptbPhotoreceptorsAnom = rmfield(ptbPhotoreceptorsAnom,'absorbance');
ptbPhotoreceptorsAnom = FillInPhotoreceptors(ptbPhotoreceptorsAnom);
T_conesQETrichromAnom = [T_conesQETrichrom(1,:) ; ptbPhotoreceptorsAnom.isomerizationAbsorptance(2,:) ; T_conesQETrichrom(3,:)];
T_conesQETetra = [ptbPhotoreceptorsSS2.isomerizationAbsorptance ; ptbPhotoreceptorsAnom.isomerizationAbsorptance(2,:)];

% Energy sensitivities.  We need these to convert the isomerizations
% into the right relative scaling for SRGB rendering.
T_conesTrichrom = EnergyToQuanta(S,T_conesQETrichrom')';
T_conesTrichrom = T_conesTrichrom/max(T_conesTrichrom(:));
for ii = 1:3
    renderingScaleFactors(ii) = 1/max(T_conesTrichrom(ii,:));
end
UnitTest.validationData('renderingScaleFactors', renderingScaleFactors);

% Some spectra.  We treat these as in quantal units,
% though since we never say in the paper what they
% are, it doesn't really matter where we got them.
load sur_mccBabel
theSpd = SplineSpd(S_mccBabel,...
    figParams.spectralConstant*ones(size(sur_mccBabel(:,figParams.whichMCCSquare))) + ...
    figParams.mccSquareScale*sur_mccBabel(:,figParams.whichMCCSquare) + ...
    figParams.mccSquareScale2*sur_mccBabel(:,figParams.whichMCCSquare2) + ...
    figParams.mccSquareScale3*sur_mccBabel(:,figParams.whichMCCSquare3),S);
theSpdCones = T_conesQETrichrom*theSpd;
UnitTest.validationData('theSpd', theSpd);
UnitTest.validationData('theSpdCones', theSpdCones);

% Some monitor primaries
load B_monitor
B = SplineSpd(S_monitor,B_monitor,S);
UnitTest.validationData('B', B);

% Compute monitor metamer for spd
theMetamer = B*inv(T_conesQETrichrom*B)*T_conesQETrichrom*theSpd;
theMetamerCones = T_conesQETrichrom*theMetamer;
UnitTest.validationData('theMetamer', theMetamer);
UnitTest.validationData('theMetamerCones', theMetamerCones);

%% Make a bar plot of cone responses to the two lights
mid1 = 1; mid2 = 2.5; mid3 = 4.0; sep = 0.25;
figParams.figName = 'FigTrichromHistoTrichomMetamers';
figParams.barWidth = 0.4;
figParams.barLineWidth = 5;
figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
xlim([sep mid3+sep+figParams.barWidth]);
h1 = bar([mid1 - sep]',[theSpdCones(1)],figParams.barWidth,'FaceColor','r','LineWidth',figParams.barLineWidth);
h2 = bar([mid1 + sep]',[theMetamerCones(1)],figParams.barWidth,'FaceColor','r','LineWidth',figParams.barLineWidth,'LineStyle',':');
h3 = bar([mid2 - sep]',[theSpdCones(2)],figParams.barWidth,'FaceColor','g','LineWidth',figParams.barLineWidth);
h4 = bar([mid2 + sep]',[theMetamerCones(2)],figParams.barWidth,'FaceColor','g','LineWidth',figParams.barLineWidth,'LineStyle',':');
h5 = bar([mid3 - sep]',[theSpdCones(3)],figParams.barWidth,'FaceColor','b','LineWidth',figParams.barLineWidth);
h6 = bar([mid3 + sep]',[theMetamerCones(3)],figParams.barWidth,'FaceColor','b','LineWidth',figParams.barLineWidth,'LineStyle',':');
set(gca,'XTick',[mid1 mid2 mid3]);
set(gca,'XTickLabel',{'L' 'Ms' 'S'},'FontName',figParams.fontName,'FontSize',figParams.labelFontSize+4);
ylim([0 1]);
set(gca,'YTick',[0 0.5 1]);
set(gca,'YTickLabel',{' 0.00 ', ' 0.50 ', ' 1.00 '},'FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylabel('Isomerization Rate (arbitrary units)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),gcf,figParams.figType);

% and just to the first light (for explanatory purposes)
figParams.figName = 'FigTrichromHistoTrichomMetamersOne';
figParams.barWidth = 0.4;
figParams.barLineWidth = 5;
figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
xlim([sep mid3+sep+figParams.barWidth]);
h1 = bar([mid1 - sep]',[theSpdCones(1)],figParams.barWidth,'FaceColor','r','LineWidth',figParams.barLineWidth);
h3 = bar([mid2 - sep]',[theSpdCones(2)],figParams.barWidth,'FaceColor','g','LineWidth',figParams.barLineWidth);
h5 = bar([mid3 - sep]',[theSpdCones(3)],figParams.barWidth,'FaceColor','b','LineWidth',figParams.barLineWidth);
set(gca,'XTick',[mid1 mid2 mid3]);
set(gca,'XTickLabel',{'L' 'M' 'S'},'FontName',figParams.fontName,'FontSize',figParams.labelFontSize+4);
ylim([0 1]);
set(gca,'YTick',[0 0.5 1]);
set(gca,'YTickLabel',{' 0.00 ', ' 0.50 ', ' 1.00 '},'FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylabel('Isomerization Rate (arbitrary units)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),gcf,figParams.figType);

% and just L cone response to first light  (again, for explanatory purposes)
figParams.figName = 'FigTrichromHistoTrichomMetamersOneLOnly';
figParams.barWidth = 0.4;
figParams.barLineWidth = 5;
figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
xlim([sep mid3+sep+figParams.barWidth]);
h1 = bar([mid1 - sep]',[theSpdCones(1)],figParams.barWidth,'FaceColor','r','LineWidth',figParams.barLineWidth);
set(gca,'XTick',[mid1 mid2 mid3]);
set(gca,'XTickLabel',{'L' 'M' 'S'},'FontName',figParams.fontName,'FontSize',figParams.labelFontSize+4);
ylim([0 1]);
set(gca,'YTick',[0 0.5 1]);
set(gca,'YTickLabel',{' 0.00 ', ' 0.50 ', ' 1.00 '},'FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylabel('Isomerization Rate (arbitrary units)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),gcf,figParams.figType);

%% Make the cone sensitivity figure
figParams.figName = 'FigTrichromCones';
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {'400' '500' '600' '700'};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 0.51;
figParams.yTicks = [0.0 0.25 0.5];
figParams.yTickLabels = {' 0.00 ' ' 0.25 ' ' 0.50 '};
theFig = figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
plot(wls,T_conesQETrichrom(1,:)','r','LineWidth',figParams.lineWidth);
plot(wls,T_conesQETrichrom(2,:)','g','LineWidth',figParams.lineWidth);
plot(wls,T_conesQETrichrom(3,:)','b','LineWidth',figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,'XTick',figParams.xTicks);
set(gca,'XTickLabel',figParams.xTickLabels);
xlabel('Wavelength (nm)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel('Quantal Efficiency','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
set(gca,'YTick',figParams.yTicks);
set(gca,'YTickLabel',figParams.yTickLabels);
legend({' L cones ' ' M cones ' ' S cones '},'Location','NorthEast','FontSize',figParams.legendFontSize);
axis('square');
%set(gca,'XMinorTick','on');
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),theFig,figParams.figType);

% and an anomalous version for explanatory purposes
figParams.figName = 'FigTrichromAnomCones';
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {'400' '500' '600' '700'};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 0.51;
figParams.yTicks = [0.0 0.25 0.5];
figParams.yTickLabels = {' 0.00 ' ' 0.25 ' ' 0.50 '};
theFig = figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
plot(wls,T_conesQETrichromAnom(1,:)','r','LineWidth',figParams.lineWidth);
plot(wls,T_conesQETrichromAnom(2,:)','y','LineWidth',figParams.lineWidth);
plot(wls,T_conesQETrichromAnom(3,:)','b','LineWidth',figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,'XTick',figParams.xTicks);
set(gca,'XTickLabel',figParams.xTickLabels);
xlabel('Wavelength (nm)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel('Quantal Efficiency','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
set(gca,'YTick',figParams.yTicks);
set(gca,'YTickLabel',figParams.yTickLabels);
legend({' L cones ' ' M'' cones ' ' S cones '},'Location','NorthEast','FontSize',figParams.legendFontSize);
axis('square');
%set(gca,'XMinorTick','on');
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),theFig,figParams.figType);

% and an tetrachomatic version for explanatory purposes
figParams.figName = 'FigTetraCones';
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {'400' '500' '600' '700'};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 0.51;
figParams.yTicks = [0.0 0.25 0.5];
figParams.yTickLabels = {' 0.00 ' ' 0.25 ' ' 0.50 '};
theFig = figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
plot(wls,T_conesQETetra(1,:)','r','LineWidth',figParams.lineWidth);
plot(wls,T_conesQETetra(4,:)','y','LineWidth',figParams.lineWidth);
plot(wls,T_conesQETetra(2,:)','g','LineWidth',figParams.lineWidth);
plot(wls,T_conesQETetra(3,:)','b','LineWidth',figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,'XTick',figParams.xTicks);
set(gca,'XTickLabel',figParams.xTickLabels);
xlabel('Wavelength (nm)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel('Quantal Efficiency','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
set(gca,'YTick',figParams.yTicks);
set(gca,'YTickLabel',figParams.yTickLabels);
legend({' L cones ' ' M'' cones ' ' M cones ' 'S cones'},'Location','NorthEast','FontSize',figParams.legendFontSize);
axis('square');
%set(gca,'XMinorTick','on');
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),theFig,figParams.figType);

%% Make the metamer figure
figParams.figName = 'FigTrichromMetam';
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {'400' '500' '600' '700'};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 1.01;
figParams.yTicks = [0.0 0.25 0.5 0.75 1.0];
figParams.yTickLabels = {' 0.00 ' ' 0.25 ' ' 0.50 ' ' 0.75 ' ' 1.00 '};
theFig = figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
plot(wls,theSpd,'k','LineWidth',figParams.lineWidth);
plot(wls,theMetamer,'k:','LineWidth',figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,'XTick',figParams.xTicks);
set(gca,'XTickLabel',figParams.xTickLabels);
xlabel('Wavelength (nm)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel('Power (arbitrary quantal units)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
set(gca,'YTick',figParams.yTicks);
set(gca,'YTickLabel',figParams.yTickLabels);
axis('square');
%set(gca,'XMinorTick','on');
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),theFig,figParams.figType);

% and a version with just the first spectrum
figParams.figName = 'FigTrichromMetamOne';
figParams.xLimLow = 380;
figParams.xLimHigh = 720;
figParams.xTicks = [400 500 600 700];
figParams.xTickLabels = {'400' '500' '600' '700'};
figParams.yLimLow = -0.01;
figParams.yLimHigh = 1.01;
figParams.yTicks = [0.0 0.25 0.5 0.75 1.0];
figParams.yTickLabels = {' 0.00 ' ' 0.25 ' ' 0.50 ' ' 0.75 ' ' 1.00 '};
theFig = figure; clf; hold on
set(gcf,'Position',[100 100 figParams.sqSize figParams.sqSize]);
set(gca,'FontName',figParams.fontName,'FontSize',figParams.axisFontSize,'LineWidth',figParams.axisLineWidth);
plot(wls,theSpd,'k','LineWidth',figParams.lineWidth);
xlim([figParams.xLimLow figParams.xLimHigh]);
set(gca,'XTick',figParams.xTicks);
set(gca,'XTickLabel',figParams.xTickLabels);
xlabel('Wavelength (nm)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
ylim([figParams.yLimLow figParams.yLimHigh]);
ylabel('Power (arbitrary quantal units)','FontName',figParams.fontName,'FontSize',figParams.labelFontSize);
set(gca,'YTick',figParams.yTicks);
set(gca,'YTickLabel',figParams.yTickLabels);
axis('square');
%set(gca,'XMinorTick','on');
FigureSave(fullfile(outputDir,[mfilename '_' figParams.figName]),theFig,figParams.figType);

end



##### SOURCE END #####
--></body></html>